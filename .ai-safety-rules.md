# AI Safety Rules for Synqra OS Deployment

## ðŸ¤– MANDATORY RULE FOR ALL AI ASSISTANTS

**âš ï¸ CRITICAL: NEVER deploy without validating the build works locally first!**

This rule MUST be followed by any AI assistant working on this codebase.

## Pre-Deployment Requirements

Before making ANY deployment-related changes (commits, pushes, Railway updates), you MUST:

### 1. Validate Build
```bash
cd noid-dashboard
npm run build
```
- Build MUST complete without errors
- Fix any build errors before proceeding

### 2. Test Server Startup
```bash
npm run start
```
- Server MUST start successfully
- No crashes or fatal errors allowed

### 3. Verify Health Endpoint
```bash
# While server is running:
curl http://localhost:3000/api/health
```
- Health endpoint MUST return 200 OK
- Response MUST include valid JSON

### 4. Test Main Application
```bash
curl http://localhost:3000
```
- Main page MUST respond
- No 500 errors allowed

## Automated Safety Check

Instead of running individual checks, use:
```bash
npm run pre-deploy
```

This runs ALL safety checks automatically.

## Safe Deployment Command

When ready to deploy:
```bash
npm run safe-deploy
```

This will:
1. Run all pre-deploy checks
2. Only push if all checks pass
3. Prevent bad deployments

## What NOT To Do

âŒ **NEVER** push changes without running `npm run pre-deploy` first
âŒ **NEVER** assume the build will work based on file edits alone
âŒ **NEVER** skip health endpoint validation
âŒ **NEVER** deploy if any check fails
âŒ **NEVER** ignore build warnings or errors

## What TO Do

âœ… **ALWAYS** run pre-deploy checks before pushing
âœ… **ALWAYS** fix build errors immediately
âœ… **ALWAYS** verify health endpoint responds
âœ… **ALWAYS** test server startup locally
âœ… **ALWAYS** document any deployment issues

## Exception Handling

If you cannot run the pre-deploy checks (e.g., environment limitations):

1. **Clearly state** that you cannot validate the build
2. **Warn the user** that manual validation is required
3. **Provide** exact commands the user should run
4. **Document** what checks you skipped and why
5. **Request** user confirmation before proceeding

### Example Exception Message:
```
âš ï¸ WARNING: Cannot validate build in current environment

The following checks could not be completed:
- Build validation (Google Fonts blocked in CI)
- Server startup test
- Health endpoint validation

REQUIRED: Please run these commands locally before deploying:
1. npm run pre-deploy
2. Verify all checks pass
3. Only then: git push

Do you want to proceed with committing these changes?
```

## Error Recovery

If a deployment fails:

1. **Check** CI logs in GitHub Actions
2. **Run** `npm run pre-deploy` locally to reproduce
3. **Fix** the issues that appear
4. **Validate** fixes with `npm run pre-deploy`
5. **Only then** push again

## Validation Evidence

When deploying, always provide evidence:
```
âœ… Pre-deploy checks completed:
  - Build: SUCCESS
  - Server startup: SUCCESS
  - Health endpoint: 200 OK
  - Main page: 200 OK

Safe to deploy.
```

Or if checks cannot run:
```
âš ï¸ Pre-deploy checks skipped due to: [reason]
âš ï¸ Manual validation REQUIRED before deployment
âš ï¸ User must run: npm run pre-deploy
```

## Learning from Failures

After any deployment failure:
1. Document what went wrong
2. Update safety checks to catch similar issues
3. Add to pre-deploy script if needed
4. Update this file with lessons learned

## AI Assistant Workflow

```
User Request: "Deploy the changes"
    â†“
Run: npm run pre-deploy
    â†“
All checks pass? â”€â”€NOâ”€â”€> Fix issues, retry
    â†“ YES
Run: git add, git commit, git push
    â†“
Provide confirmation to user
    â†“
Done âœ…
```

## Remember

This safety system exists because:
- Railway deployments are public-facing
- Failed deployments cause downtime
- Prevention is better than recovery
- Automated checks catch issues early
- Manual fixes are expensive

**Following these rules protects users, maintains uptime, and ensures quality deployments.**

---

*This file should be referenced in every AI conversation about deployment.*
*All AI assistants MUST acknowledge and follow these rules.*
