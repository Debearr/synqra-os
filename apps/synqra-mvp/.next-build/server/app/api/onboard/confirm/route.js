(()=>{var e={};e.id=4974,e.ids=[4291,4974],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},6923:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>E,routeModule:()=>d,serverHooks:()=>S,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>f});var n={};t.r(n),t.d(n,{POST:()=>p});var o=t(1271),a=t(1232),s=t(8079),i=t(1238),l=t(2892),u=t(4493);let c=u.Ik({name:u.Yj().min(1,"Name is required"),title:u.Yj().min(1,"Title is required"),company:u.Yj().min(1,"Company is required"),location:u.Yj().optional(),headline:u.Yj().optional(),summary:u.Yj().optional(),website:u.Yj().url().optional().or(u.eu("")),linkedin:u.Yj().url().optional().or(u.eu("")),twitter:u.Yj().url().optional().or(u.eu("")),newsletter:u.Yj().optional(),tone:u.Yj().optional(),contentPillars:u.YO(u.Yj()).default([]),proofPoints:u.YO(u.Yj()).default([])});async function p(e){try{let r=await e.json(),t=c.safeParse(r);if(!t.success)return i.NextResponse.json({ok:!1,error:"validation_failed",message:"Please complete required fields: name, title, company",details:t.error.issues},{status:400});let n=t.data,o=(0,l.H)(),a=function(e){let r=e.toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,20),t=Date.now().toString(36);return`${r}.${t}@synqra.pilot`}(n.name),s=function(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*",r="";for(let t=0;t<24;t++)r+=e.charAt(Math.floor(Math.random()*e.length));return r}(),{data:u,error:p}=await o.auth.admin.createUser({email:a,password:s,email_confirm:!0,user_metadata:{full_name:n.name,onboarded_via:"profile_extract",onboarded_at:new Date().toISOString()}});if(p||!u.user)return console.error("[Onboard Confirm] Auth creation failed:",p),i.NextResponse.json({ok:!1,error:"account_creation_failed",message:"Failed to create user account"},{status:500});let d=u.user.id,{data:m,error:f}=await o.from("pilot_agents").insert([{user_id:d,name:n.name,title:n.title,company:n.company,location:n.location||null,headline:n.headline||null,summary:n.summary||null,website:n.website||null,linkedin:n.linkedin||null,twitter:n.twitter||null,newsletter:n.newsletter||null,tone:n.tone||null,content_pillars:n.contentPillars,proof_points:n.proofPoints,status:"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(f)return console.error("[Onboard Confirm] Profile creation failed:",f),await o.auth.admin.deleteUser(d).catch(e=>{console.error("[Onboard Confirm] Cleanup failed:",e)}),i.NextResponse.json({ok:!1,error:"profile_creation_failed",message:"Failed to create pilot profile"},{status:500});return console.log("[Onboard Confirm] Success:",{userId:d,profileId:m.id,name:n.name}),i.NextResponse.json({ok:!0,message:"Profile confirmed and account created",data:{userId:d,profileId:m.id,redirectUrl:"/",tempCredentials:{email:a,password:s}}})}catch(e){return console.error("[Onboard Confirm] Unexpected error:",e),i.NextResponse.json({ok:!1,error:"server_error",message:"An unexpected error occurred"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/onboard/confirm/route",pathname:"/api/onboard/confirm",filename:"route",bundlePath:"app/api/onboard/confirm/route"},resolvedPagePath:"C:\\Projects\\Synqra\\apps\\synqra-mvp\\app\\api\\onboard\\confirm\\route.ts",nextConfigOutput:"standalone",userland:n}),{workAsyncStorage:m,workUnitAsyncStorage:f,serverHooks:S}=d;function E(){return(0,s.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:f})}},7032:()=>{},408:()=>{},2892:(e,r,t)=>{"use strict";t.d(r,{H:()=>i});var n=t(1525),o=t(4291);let a=null,s=null;try{let e=(0,o.getSupabaseUrl)(),r=(0,o.F)();a=(0,n.createClient)(e,r,{auth:{persistSession:!1,autoRefreshToken:!1},db:{schema:"public"}})}catch(e){s=e instanceof Error?e:Error("Unknown Supabase admin init error"),a=null}function i(){if(!a)throw Error("âŒ Supabase Admin client not available. Ensure SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY are set in Railway Variables and restart."+(s?` Details: ${s.message}`:""));return a}},4291:(e,r,t)=>{"use strict";t.d(r,{F:()=>i,getSupabaseAnonKey:()=>s,getSupabaseUrl:()=>a});let n=["SUPABASE_SERVICE_KEY","SUPABASE_SERVICE_ROLE"];function o(e,r){if(!e||""===e.trim())throw Error(`[Supabase Env] ${r} is missing or empty`);return e}function a(){let e=o(process.env.SUPABASE_URL,"SUPABASE_URL");return function(e,r){try{let t=new URL(e);if("http:"!==t.protocol&&"https:"!==t.protocol)throw Error(`[Supabase Env] ${r} must start with http:// or https://`)}catch(e){throw Error(`[Supabase Env] ${r} is invalid: ${e instanceof Error?e.message:"Unknown URL error"}`)}}(e,"SUPABASE_URL"),e}function s(){return o(process.env.SUPABASE_ANON_KEY,"SUPABASE_ANON_KEY")}function i(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;if(e&&""!==e.trim())return e;for(let e of n){let r=process.env[e];if(r&&""!==r.trim())return console.warn(`[Supabase Env] Falling back to ${e}. Set SUPABASE_SERVICE_ROLE_KEY and restart.`),r}throw Error("[Supabase Env] SUPABASE_SERVICE_ROLE_KEY is missing or empty")}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[6207,8048,1525,4493],()=>t(6923));module.exports=n})();