(()=>{var e={};e.id=9013,e.ids=[4291,9013],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},1835:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>m,serverHooks:()=>g,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>E});var o={};r.r(o),r.d(o,{GET:()=>d,POST:()=>c});var n=r(1271),s=r(1232),a=r(8079),i=r(1238),u=r(2892),l=r(1062),p=r(1540);async function c(e){let t=(0,u.H)();try{let{jobId:r,variantIds:o,platforms:n,adminToken:s}=await e.json(),a=process.env.ADMIN_TOKEN||"change-me";if(!s||s!==a)return i.NextResponse.json({ok:!1,error:"Unauthorized - invalid admin token"},{status:401});if(!r||!n||!Array.isArray(n))return i.NextResponse.json({ok:!1,error:"Missing jobId or platforms"},{status:400});if(!p.$.postingEnabled&&!p.$.dryRun)return i.NextResponse.json({ok:!1,error:"Posting disabled by system configuration"},{status:403});let{data:u,error:c}=await t.from("content_jobs").select("*").eq("id",r).single();if(c||!u)return i.NextResponse.json({ok:!1,error:"Job not found"},{status:404});let d=t.from("content_variants").select("*").eq("job_id",r);o&&o.length>0&&(d=d.in("id",o));let{data:m,error:f}=await d;if(f||!m||0===m.length)return i.NextResponse.json({ok:!1,error:"No variants found"},{status:404});let E=[];for(let e of n){let o=m.find(t=>t.platform===e);if(!o){console.warn(`‚ö†Ô∏è  No variant found for platform: ${e}`);continue}let n={text:o.content};o.media_url&&(n.media=[{url:o.media_url,title:o.media_metadata?.title||""}]),(0,l.Z)({platform:e,payload:n,jobId:r}),E.push({platform:e,variantId:o.id}),await t.from("scheduled_posts").insert({job_id:r,variant_id:o.id,platform:e,scheduled_for:new Date().toISOString(),status:"queued"})}return i.NextResponse.json({ok:!0,jobId:r,approved:!0,enqueued:E,dryRun:p.$.dryRun,message:p.$.dryRun?`Approved in DRY_RUN mode - ${E.length} jobs queued (no actual posts)`:`Approved and queued ${E.length} posts`})}catch(e){return console.error("Approve error:",e),i.NextResponse.json({ok:!1,error:e.message},{status:500})}}async function d(e){let t=(0,u.H)();try{let r=e.nextUrl.searchParams.get("adminToken"),o=process.env.ADMIN_TOKEN||"change-me";if(!r||r!==o)return i.NextResponse.json({ok:!1,error:"Unauthorized"},{status:401});let{data:n,error:s}=await t.from("content_jobs").select(`
        *,
        variants:content_variants(*)
      `).order("created_at",{ascending:!1}).limit(50);if(s)throw s;return i.NextResponse.json({ok:!0,jobs:n||[],total:n?.length||0})}catch(e){return console.error("Get approvals error:",e),i.NextResponse.json({ok:!1,error:e.message},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/approve/route",pathname:"/api/approve",filename:"route",bundlePath:"app/api/approve/route"},resolvedPagePath:"C:\\Projects\\Synqra\\apps\\synqra-mvp\\app\\api\\approve\\route.ts",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:f,workUnitAsyncStorage:E,serverHooks:g}=m;function h(){return(0,a.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:E})}},7032:()=>{},408:()=>{},1540:(e,t,r)=>{"use strict";r.d(t,{$:()=>o,_:()=>n});let o={dryRun:"false"!==process.env.DRY_RUN,postingEnabled:"true"===process.env.POSTING_ENABLED,approvalRequired:"false"!==process.env.APPROVAL_REQUIRED,timezone:process.env.DEFAULT_TIMEZONE||"America/Toronto",retryAttempts:3,retryDelays:[1e4,3e4,6e4]};function n(){return o.dryRun?(console.log("\uD83E\uDDEA DRY_RUN mode - no actual posting"),!1):!!o.postingEnabled||(console.log("\uD83D\uDEAB Posting disabled"),!1)}},1062:(e,t,r)=>{"use strict";r.d(t,{Z:()=>m,F:()=>E});var o=r(1540),n=r(1525);async function s(e,t){let r=function(){let e=process.env.SUPABASE_URL,t=process.env.SUPABASE_SERVICE_KEY||process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Missing Supabase configuration");return(0,n.createClient)(e,t)}(),{data:o,error:s}=await r.from("social_tokens").select("access_token, account_id").eq("platform","LinkedIn").order("created_at",{ascending:!1}).limit(1).single();if(s||!o)throw Error("LinkedIn token not found - run OAuth flow first");let{access_token:a}=o,i=t||o.account_id;if(!i)throw Error("LinkedIn account ID not configured");let u={author:i,lifecycleState:"PUBLISHED",specificContent:{"com.linkedin.ugc.ShareContent":{shareCommentary:{text:e.text},shareMediaCategory:e.media?"IMAGE":"NONE",...e.media&&{media:e.media.map(e=>({status:"READY",originalUrl:e.url,title:{text:e.title||""}}))}}},visibility:{"com.linkedin.ugc.MemberNetworkVisibility":"PUBLIC"}},l=await fetch("https://api.linkedin.com/v2/ugcPosts",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json","X-Restli-Protocol-Version":"2.0.0"},body:JSON.stringify(u)});if(!l.ok){let e=await l.text();throw Error(`LinkedIn API error: ${l.status} - ${e}`)}let p=await l.json();return await r.from("posting_logs").insert({platform:"LinkedIn",status:"success",response:p,external_id:p.id}),p}async function a(e){throw console.log("\uD83D\uDCF1 TikTok posting stub - implement OAuth flow"),Error("TikTok integration pending - requires OAuth setup")}async function i(e){throw console.log("\uD83D\uDCFA YouTube posting stub - implement OAuth flow"),Error("YouTube integration pending - requires OAuth setup")}async function u(e){throw console.log("\uD83D\uDC26 X posting stub - implement OAuth flow"),Error("X integration pending - requires OAuth setup")}async function l(e){throw console.log("\uD83D\uDCF8 Instagram posting stub - implement OAuth flow"),Error("Instagram integration pending - requires OAuth setup")}async function p(e,t){if(!(0,o._)())return{ok:!0,action:"dry-run",platform:e,payload:t,message:"DRY_RUN mode - no actual post made"};let r={LinkedIn:s,TikTok:a,YouTube:i,X:u,Instagram:l}[e];if(!r)throw Error(`Unsupported platform: ${e}`);try{let o=await r(t);return console.log(`‚úÖ Posted to ${e}`,o),{ok:!0,platform:e,result:o}}catch(t){throw console.error(`‚ùå Failed to post to ${e}:`,t.message),t}}let c=[],d=!1;function m(e){let t={...e,id:crypto.randomUUID(),attempts:0};c.push(t),console.log(`üì• Enqueued: ${e.platform} for job ${e.jobId}`),f()}async function f(){if(!d&&0!==c.length){d=!0;try{let e=c.shift();if(!e)return;try{await p(e.platform,e.payload),console.log(`‚úÖ Processed: ${e.platform} for job ${e.jobId}`)}catch(t){if(e.attempts++,e.attempts<o.$.retryAttempts){let t=o.$.retryDelays[e.attempts-1]||6e4;console.log(`‚è∞ Retry ${e.attempts}/${o.$.retryAttempts} for ${e.platform} in ${t}ms`),setTimeout(()=>{c.unshift(e),f()},t)}else console.error(`‚ùå Failed permanently: ${e.platform} for job ${e.jobId}`,t.message)}}finally{d=!1,c.length>0&&setTimeout(f,1e3)}}}function E(){return c.length}},2892:(e,t,r)=>{"use strict";r.d(t,{H:()=>i});var o=r(1525),n=r(4291);let s=null,a=null;try{let e=(0,n.getSupabaseUrl)(),t=(0,n.F)();s=(0,o.createClient)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1},db:{schema:"public"}})}catch(e){a=e instanceof Error?e:Error("Unknown Supabase admin init error"),s=null}function i(){if(!s)throw Error("‚ùå Supabase Admin client not available. Ensure SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY are set in Railway Variables and restart."+(a?` Details: ${a.message}`:""));return s}},4291:(e,t,r)=>{"use strict";r.d(t,{F:()=>i,getSupabaseAnonKey:()=>a,getSupabaseUrl:()=>s});let o=["SUPABASE_SERVICE_KEY","SUPABASE_SERVICE_ROLE"];function n(e,t){if(!e||""===e.trim())throw Error(`[Supabase Env] ${t} is missing or empty`);return e}function s(){let e=n(process.env.SUPABASE_URL,"SUPABASE_URL");return function(e,t){try{let r=new URL(e);if("http:"!==r.protocol&&"https:"!==r.protocol)throw Error(`[Supabase Env] ${t} must start with http:// or https://`)}catch(e){throw Error(`[Supabase Env] ${t} is invalid: ${e instanceof Error?e.message:"Unknown URL error"}`)}}(e,"SUPABASE_URL"),e}function a(){return n(process.env.SUPABASE_ANON_KEY,"SUPABASE_ANON_KEY")}function i(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;if(e&&""!==e.trim())return e;for(let e of o){let t=process.env[e];if(t&&""!==t.trim())return console.warn(`[Supabase Env] Falling back to ${e}. Set SUPABASE_SERVICE_ROLE_KEY and restart.`),t}throw Error("[Supabase Env] SUPABASE_SERVICE_ROLE_KEY is missing or empty")}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[6207,8048,1525],()=>r(1835));module.exports=o})();