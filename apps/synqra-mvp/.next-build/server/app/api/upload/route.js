(()=>{var e={};e.id=5413,e.ids=[4291,5413],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5585:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>S,routeModule:()=>d,serverHooks:()=>m,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>E});var s={};t.r(s),t.d(s,{POST:()=>l});var o=t(1271),a=t(1232),n=t(8079),i=t(1238),p=t(2892);let u=["image/jpeg","image/png","image/gif","image/webp","video/mp4","video/quicktime"];async function l(e){let r=(0,p.H)();try{let t=(await e.formData()).get("file");if(!t)return i.NextResponse.json({ok:!1,error:"No file provided"},{status:400});if(!u.includes(t.type))return i.NextResponse.json({ok:!1,error:`File type ${t.type} not allowed. Allowed: ${u.join(", ")}`},{status:400});if(t.size>0x3200000)return i.NextResponse.json({ok:!1,error:`File size ${(t.size/1024/1024).toFixed(2)}MB exceeds 50MB limit`},{status:400});let s=Date.now(),o=t.name.split(".").pop(),a=`${s}-${Math.random().toString(36).substring(7)}.${o}`,n=Buffer.from(await t.arrayBuffer()),{error:p}=await r.storage.from("synqra-media").upload(a,n,{contentType:t.type,cacheControl:"3600",upsert:!1});if(p)return console.error("Upload error:",p),i.NextResponse.json({ok:!1,error:`Upload failed: ${p.message}`},{status:500});let{data:{publicUrl:l}}=r.storage.from("synqra-media").getPublicUrl(a);return i.NextResponse.json({ok:!0,url:l,type:t.type.startsWith("image/")?"image":"video",metadata:{filename:t.name,size:t.size,mimeType:t.type}})}catch(e){return console.error("Upload error:",e),i.NextResponse.json({ok:!1,error:e.message},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"C:\\Projects\\Synqra\\apps\\synqra-mvp\\app\\api\\upload\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:c,workUnitAsyncStorage:E,serverHooks:m}=d;function S(){return(0,n.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:E})}},7032:()=>{},408:()=>{},2892:(e,r,t)=>{"use strict";t.d(r,{H:()=>i});var s=t(1525),o=t(4291);let a=null,n=null;try{let e=(0,o.getSupabaseUrl)(),r=(0,o.F)();a=(0,s.createClient)(e,r,{auth:{persistSession:!1,autoRefreshToken:!1},db:{schema:"public"}})}catch(e){n=e instanceof Error?e:Error("Unknown Supabase admin init error"),a=null}function i(){if(!a)throw Error("âŒ Supabase Admin client not available. Ensure SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY are set in Railway Variables and restart."+(n?` Details: ${n.message}`:""));return a}},4291:(e,r,t)=>{"use strict";t.d(r,{F:()=>i,getSupabaseAnonKey:()=>n,getSupabaseUrl:()=>a});let s=["SUPABASE_SERVICE_KEY","SUPABASE_SERVICE_ROLE"];function o(e,r){if(!e||""===e.trim())throw Error(`[Supabase Env] ${r} is missing or empty`);return e}function a(){let e=o(process.env.SUPABASE_URL,"SUPABASE_URL");return function(e,r){try{let t=new URL(e);if("http:"!==t.protocol&&"https:"!==t.protocol)throw Error(`[Supabase Env] ${r} must start with http:// or https://`)}catch(e){throw Error(`[Supabase Env] ${r} is invalid: ${e instanceof Error?e.message:"Unknown URL error"}`)}}(e,"SUPABASE_URL"),e}function n(){return o(process.env.SUPABASE_ANON_KEY,"SUPABASE_ANON_KEY")}function i(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;if(e&&""!==e.trim())return e;for(let e of s){let r=process.env[e];if(r&&""!==r.trim())return console.warn(`[Supabase Env] Falling back to ${e}. Set SUPABASE_SERVICE_ROLE_KEY and restart.`),r}throw Error("[Supabase Env] SUPABASE_SERVICE_ROLE_KEY is missing or empty")}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[6207,8048,1525],()=>t(5585));module.exports=s})();