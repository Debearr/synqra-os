(()=>{var e={};e.id=3034,e.ids=[3034,4291],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},4835:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>S,serverHooks:()=>f,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>A});var n={};r.r(n),r.d(n,{DELETE:()=>d,GET:()=>p,PATCH:()=>E,POST:()=>l,PUT:()=>c});var s=r(1271),o=r(1232),a=r(8079),i=r(1238),u=r(7164);async function l(e){try{let t=await e.json();if(!t.platform||!t.videoId)return i.NextResponse.json({error:"Invalid request",message:"Both 'platform' and 'videoId' are required"},{status:400});let{platform:r,videoId:n,avgViewDuration:s,avgCompletion:o,notes:a}=t,l=(0,u.U)(),{data:p,error:c}=await l.from("retention_notes").insert({platform:r,video_id:n,avg_view_duration:s||null,avg_completion:o||null,notes:a||null}).select().single();if(c)return console.error("Failed to save retention note:",c),i.NextResponse.json({error:"Database error",message:c.message},{status:500});let d=new Date().toISOString(),E=`[RETENTION] ${d} | Platform: ${r} | Video: ${n} | Duration: ${s||"N/A"}s | Completion: ${o||"N/A"}%`;return console.log(E),i.NextResponse.json({id:p.id,platform:r,videoId:n,avgViewDuration:s,avgCompletion:o,notes:a,timestamp:p.created_at},{status:201})}catch(e){return console.error("Retention note save error:",e),i.NextResponse.json({error:"Failed to save retention note",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function p(e){try{let{searchParams:t}=new URL(e.url),r=t.get("platform"),n=parseInt(t.get("limit")||"50"),s=(0,u.U)().from("retention_notes").select("*").order("created_at",{ascending:!1}).limit(n);r&&(s=s.eq("platform",r));let{data:o,error:a}=await s;if(a)return console.error("Failed to fetch retention notes:",a),i.NextResponse.json({error:"Database error",message:a.message},{status:500});return i.NextResponse.json({notes:o||[],count:o?.length||0,platform:r||"all"})}catch(e){return console.error("Retention notes fetch error:",e),i.NextResponse.json({error:"Failed to fetch retention notes",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function c(){return new i.NextResponse("Method Not Allowed",{status:405,headers:{Allow:"GET, POST"}})}async function d(){return new i.NextResponse("Method Not Allowed",{status:405,headers:{Allow:"GET, POST"}})}async function E(){return new i.NextResponse("Method Not Allowed",{status:405,headers:{Allow:"GET, POST"}})}let S=new s.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/retention/notes/route",pathname:"/api/retention/notes",filename:"route",bundlePath:"app/api/retention/notes/route"},resolvedPagePath:"C:\\Projects\\Synqra\\apps\\synqra-mvp\\app\\api\\retention\\notes\\route.ts",nextConfigOutput:"standalone",userland:n}),{workAsyncStorage:m,workUnitAsyncStorage:A,serverHooks:f}=S;function g(){return(0,a.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:A})}},7032:()=>{},408:()=>{},7164:(e,t,r)=>{"use strict";r.d(t,{U:()=>i});var n=r(1525),s=r(4291);let o=null,a=null;try{let e=(0,s.getSupabaseUrl)(),t=(0,s.getSupabaseAnonKey)();o=(0,n.createClient)(e,t)}catch(e){a=e instanceof Error?e:Error("Unknown Supabase init error"),o=null}function i(){if(!o)throw Error("âŒ Supabase client not available. Ensure SUPABASE_URL and SUPABASE_ANON_KEY are set in Railway Variables and restart."+(a?` Details: ${a.message}`:""));return o}},4291:(e,t,r)=>{"use strict";r.d(t,{F:()=>i,getSupabaseAnonKey:()=>a,getSupabaseUrl:()=>o});let n=["SUPABASE_SERVICE_KEY","SUPABASE_SERVICE_ROLE"];function s(e,t){if(!e||""===e.trim())throw Error(`[Supabase Env] ${t} is missing or empty`);return e}function o(){let e=s(process.env.SUPABASE_URL,"SUPABASE_URL");return function(e,t){try{let r=new URL(e);if("http:"!==r.protocol&&"https:"!==r.protocol)throw Error(`[Supabase Env] ${t} must start with http:// or https://`)}catch(e){throw Error(`[Supabase Env] ${t} is invalid: ${e instanceof Error?e.message:"Unknown URL error"}`)}}(e,"SUPABASE_URL"),e}function a(){return s(process.env.SUPABASE_ANON_KEY,"SUPABASE_ANON_KEY")}function i(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;if(e&&""!==e.trim())return e;for(let e of n){let t=process.env[e];if(t&&""!==t.trim())return console.warn(`[Supabase Env] Falling back to ${e}. Set SUPABASE_SERVICE_ROLE_KEY and restart.`),t}throw Error("[Supabase Env] SUPABASE_SERVICE_ROLE_KEY is missing or empty")}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[6207,8048,1525],()=>r(4835));module.exports=n})();