(()=>{var e={};e.id=8342,e.ids=[4291,8342],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},4923:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>S,routeModule:()=>d,serverHooks:()=>_,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>E});var n={};t.r(n),t.d(n,{GET:()=>u});var o=t(1271),a=t(1232),i=t(8079),s=t(1238),c=t(2892);let l="synqra_oauth_li_state";async function u(e){let r=(0,c.H)(),t=e.nextUrl.searchParams,n=t.get("code"),o=t.get("error"),a=t.get("state"),i=e.cookies.get(l)?.value||null;if(o)return console.error("LinkedIn OAuth error:",o,t.get("error_description")||"Unknown error"),s.NextResponse.redirect("/admin/integrations?error=linkedin_denied");if(!a||!i||a!==i)return s.NextResponse.redirect("/admin/integrations?error=linkedin_state_mismatch");if(!n)return s.NextResponse.json({ok:!1,error:"No authorization code received"},{status:400});let u=process.env.LINKEDIN_CLIENT_ID,d=process.env.LINKEDIN_CLIENT_SECRET,p=process.env.LINKEDIN_REDIRECT_URI;if(!u||!d||!p)return s.NextResponse.json({ok:!1,error:"LinkedIn OAuth credentials not configured"},{status:500});try{let e=await fetch("https://www.linkedin.com/oauth/v2/accessToken",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:n,client_id:u,client_secret:d,redirect_uri:p})});if(!e.ok){let r=await e.text();return console.error("LinkedIn token exchange failed:",r),s.NextResponse.redirect("/admin/integrations?error=linkedin_token_failed")}let t=await e.json(),o=await fetch("https://api.linkedin.com/v2/me",{headers:{Authorization:`Bearer ${t.access_token}`}});if(!o.ok)return console.error("Failed to fetch LinkedIn profile"),s.NextResponse.redirect("/admin/integrations?error=linkedin_profile_failed");let a=await o.json(),i=`urn:li:person:${a.id}`,c=new Date(Date.now()+1e3*t.expires_in).toISOString(),{error:E}=await r.from("social_tokens").upsert({platform:"LinkedIn",account_id:i,access_token:t.access_token,refresh_token:t.refresh_token||null,expires_at:c,updated_at:new Date().toISOString()},{onConflict:"platform,account_id"});if(E)return console.error("Database error:",E),s.NextResponse.redirect("/admin/integrations?error=database_failed");let _=s.NextResponse.redirect("/admin/integrations?success=linkedin");return _.cookies.set(l,"",{path:"/",maxAge:0}),_}catch(r){console.error("LinkedIn OAuth callback error:",r);let e=s.NextResponse.redirect("/admin/integrations?error=unexpected");return e.cookies.set(l,"",{path:"/",maxAge:0}),e}}let d=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/oauth/linkedin/callback/route",pathname:"/api/oauth/linkedin/callback",filename:"route",bundlePath:"app/api/oauth/linkedin/callback/route"},resolvedPagePath:"C:\\Projects\\Synqra\\apps\\synqra-mvp\\app\\api\\oauth\\linkedin\\callback\\route.ts",nextConfigOutput:"standalone",userland:n}),{workAsyncStorage:p,workUnitAsyncStorage:E,serverHooks:_}=d;function S(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:E})}},7032:()=>{},408:()=>{},2892:(e,r,t)=>{"use strict";t.d(r,{H:()=>s});var n=t(1525),o=t(4291);let a=null,i=null;try{let e=(0,o.getSupabaseUrl)(),r=(0,o.F)();a=(0,n.createClient)(e,r,{auth:{persistSession:!1,autoRefreshToken:!1},db:{schema:"public"}})}catch(e){i=e instanceof Error?e:Error("Unknown Supabase admin init error"),a=null}function s(){if(!a)throw Error("âŒ Supabase Admin client not available. Ensure SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY are set in Railway Variables and restart."+(i?` Details: ${i.message}`:""));return a}},4291:(e,r,t)=>{"use strict";t.d(r,{F:()=>s,getSupabaseAnonKey:()=>i,getSupabaseUrl:()=>a});let n=["SUPABASE_SERVICE_KEY","SUPABASE_SERVICE_ROLE"];function o(e,r){if(!e||""===e.trim())throw Error(`[Supabase Env] ${r} is missing or empty`);return e}function a(){let e=o(process.env.SUPABASE_URL,"SUPABASE_URL");return function(e,r){try{let t=new URL(e);if("http:"!==t.protocol&&"https:"!==t.protocol)throw Error(`[Supabase Env] ${r} must start with http:// or https://`)}catch(e){throw Error(`[Supabase Env] ${r} is invalid: ${e instanceof Error?e.message:"Unknown URL error"}`)}}(e,"SUPABASE_URL"),e}function i(){return o(process.env.SUPABASE_ANON_KEY,"SUPABASE_ANON_KEY")}function s(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;if(e&&""!==e.trim())return e;for(let e of n){let r=process.env[e];if(r&&""!==r.trim())return console.warn(`[Supabase Env] Falling back to ${e}. Set SUPABASE_SERVICE_ROLE_KEY and restart.`),r}throw Error("[Supabase Env] SUPABASE_SERVICE_ROLE_KEY is missing or empty")}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[6207,8048,1525],()=>t(4923));module.exports=n})();