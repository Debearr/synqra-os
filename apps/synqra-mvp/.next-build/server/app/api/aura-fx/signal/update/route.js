(()=>{var e={};e.id=1459,e.ids=[1459,4291],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},7230:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>A,routeModule:()=>g,serverHooks:()=>_,workAsyncStorage:()=>S,workUnitAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{POST:()=>E});var s=r(1271),n=r(1232),o=r(8079),i=r(1238),l=r(4493),u=r(8813),p=r(9475);let c=l.k5(["open","tp1","tp2","tp3","closed","stopped"]),d=l.Ik({id:l.Yj().uuid(),status:c,note:l.Yj().optional()});async function E(e){try{let t=await e.json(),r=d.safeParse(t);if(!r.success)return i.NextResponse.json({error:r.error.message},{status:400});let{id:a,status:s,note:n}=r.data;if(await (0,u._)(a,s,n),["closed","tp1","tp2","tp3","stopped"].includes(s)){let e=["<b>AURA-FX SIGNAL UPDATE</b>",`ID: ${a}`,`Status: ${s}`,n?`Note: ${n}`:null,`Educational use only — not financial advice`].filter(Boolean).join("\n");await (0,p.V)(e)}return i.NextResponse.json({ok:!0})}catch(t){let e=t instanceof Error?t.message:"Unknown error";return i.NextResponse.json({error:e},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/aura-fx/signal/update/route",pathname:"/api/aura-fx/signal/update",filename:"route",bundlePath:"app/api/aura-fx/signal/update/route"},resolvedPagePath:"C:\\Projects\\Synqra\\apps\\synqra-mvp\\app\\api\\aura-fx\\signal\\update\\route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:S,workUnitAsyncStorage:f,serverHooks:_}=g;function A(){return(0,o.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:f})}},7032:()=>{},408:()=>{},9475:(e,t,r)=>{"use strict";r.d(t,{V:()=>o});let a=process.env.TELEGRAM_BOT_TOKEN,s=process.env.TELEGRAM_CHANNEL_ID,n=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");async function o(e){if(!a||!s){console.warn("[AuraFX] Telegram credentials missing; skipping send.");return}let t=`https://api.telegram.org/bot${a}/sendMessage`,r={chat_id:s,text:n(e),parse_mode:"HTML"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}catch(e){console.warn("[AuraFX] Telegram send failed",e)}}},8813:(e,t,r)=>{"use strict";r.d(t,{_:()=>n,h:()=>s});var a=r(2892);async function s(e){let t=(0,a.H)(),{data:r,error:s}=await t.from("aura_signals").insert({pair:e.pair,style:e.style,direction:e.direction,entry:e.entry,stop:e.stop,tp1:e.tp1??null,tp2:e.tp2??null,tp3:e.tp3??null,reason:e.reason??null,notes:e.notes??null}).select("id").single();if(s)throw Error(`Failed to log signal: ${s.message}`);let n=r.id,{error:o}=await t.from("aura_signal_history").insert({signal_id:n,status:"open",note:e.reason??null});if(o)throw Error(`Failed to log signal history: ${o.message}`);return n}async function n(e,t,r){let s=(0,a.H)(),{error:n}=await s.from("aura_signals").update({status:t,notes:r??null,updated_at:new Date().toISOString()}).eq("id",e);if(!n){let a=await s.from("aura_signal_history").insert({signal_id:e,status:t,note:r??null}).then(e=>e.error);if(a)throw Error(`Failed to log history: ${a.message}`)}if(n)throw Error(`Failed to update signal: ${n.message}`)}},2892:(e,t,r)=>{"use strict";r.d(t,{H:()=>i});var a=r(1525),s=r(4291);let n=null,o=null;try{let e=(0,s.getSupabaseUrl)(),t=(0,s.F)();n=(0,a.createClient)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1},db:{schema:"public"}})}catch(e){o=e instanceof Error?e:Error("Unknown Supabase admin init error"),n=null}function i(){if(!n)throw Error("❌ Supabase Admin client not available. Ensure SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY are set in Railway Variables and restart."+(o?` Details: ${o.message}`:""));return n}},4291:(e,t,r)=>{"use strict";r.d(t,{F:()=>i,getSupabaseAnonKey:()=>o,getSupabaseUrl:()=>n});let a=["SUPABASE_SERVICE_KEY","SUPABASE_SERVICE_ROLE"];function s(e,t){if(!e||""===e.trim())throw Error(`[Supabase Env] ${t} is missing or empty`);return e}function n(){let e=s(process.env.SUPABASE_URL,"SUPABASE_URL");return function(e,t){try{let r=new URL(e);if("http:"!==r.protocol&&"https:"!==r.protocol)throw Error(`[Supabase Env] ${t} must start with http:// or https://`)}catch(e){throw Error(`[Supabase Env] ${t} is invalid: ${e instanceof Error?e.message:"Unknown URL error"}`)}}(e,"SUPABASE_URL"),e}function o(){return s(process.env.SUPABASE_ANON_KEY,"SUPABASE_ANON_KEY")}function i(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;if(e&&""!==e.trim())return e;for(let e of a){let t=process.env[e];if(t&&""!==t.trim())return console.warn(`[Supabase Env] Falling back to ${e}. Set SUPABASE_SERVICE_ROLE_KEY and restart.`),t}throw Error("[Supabase Env] SUPABASE_SERVICE_ROLE_KEY is missing or empty")}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[6207,8048,1525,4493],()=>r(7230));module.exports=a})();