(()=>{var e={};e.id=425,e.ids=[425],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},1990:(e,t,i)=>{"use strict";i.r(t),i.d(t,{patchFetch:()=>R,routeModule:()=>E,serverHooks:()=>O,workAsyncStorage:()=>H,workUnitAsyncStorage:()=>N});var r={};i.r(r),i.d(r,{POST:()=>B});var n=i(1271),s=i(1232),o=i(8079),a=i(1238),l=i(2780);let c=require("node:crypto");var u=i.n(c);let p={randomUUID:u().randomUUID},d=new Uint8Array(256),h=d.length,f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1));let g=function(e,t,i){if(p.randomUUID&&!t&&!e)return p.randomUUID();let r=(e=e||{}).random||(e.rng||function(){return h>d.length-16&&(u().randomFillSync(d),h=0),d.slice(h,h+=16)})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=r[e];return t}return function(e,t=0){return(f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]).toLowerCase()}(r)},S=e=>Math.max(0,Math.min(1,e)),m=process.env.TELEGRAM_BOT_TOKEN,y=process.env.TELEGRAM_CHAT_ID,L="1"===process.env.AURAFX_TELEGRAM_ENABLED||"true"===process.env.AURAFX_TELEGRAM_ENABLED;async function w(e){if(!L){console.warn("[AuraFX] Telegram broadcast skipped: AURAFX_TELEGRAM_ENABLED not set");return}if(!m||!y){console.warn("[AuraFX] Telegram broadcast skipped: TELEGRAM_BOT_TOKEN or TELEGRAM_CHAT_ID missing");return}let t=`AURA-FX ${e.symbol} ${e.timeframe}
Bias: ${e.direction} | Confidence: ${(100*e.confidence).toFixed(0)}%
Entry: ${I(e.entryZone)} | Stop: ${I(e.stopZone)} | Target: ${I(e.targetZone)}
Killzone: ${e.killzone}
Why: ${e.rationaleShort}`,i=`https://api.telegram.org/bot${m}/sendMessage`,r=JSON.stringify({chat_id:y,text:t});try{await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:r})}catch(e){console.warn("[AuraFX] Telegram broadcast failed",e)}}function I(e){return"string"==typeof e?e:`${e.low.toFixed(5)} - ${e.high.toFixed(5)}`}var A=i(6357);async function B(e){try{let t=new URL(e.url),i="1"===t.searchParams.get("broadcast"),{symbol:r,timeframe:n,candles:s,tzOffsetMinutes:o}=await e.json();if(!r||!n||!Array.isArray(s)||s.length<3)return a.NextResponse.json({error:"symbol, timeframe, and at least 3 candles are required"},{status:400});let c=(0,l.F)({candles:s,tzOffsetMinutes:o??0}),u=function(e,t){let i=e.confluence.primaryBias,r=S(e.confluence.overallScore),n=function(e){let t=e.orderBlocks.slice(-1)[0];if(t)return t.priceRange;let i=e.structurePoints.slice(-1)[0];return i?`Around ${i.price.toFixed(5)}`:"Await setup"}(e),s=function(e,t){let i=e.structurePoints.filter(e=>"SWING_LOW"===e.type).slice(-1)[0],r=e.structurePoints.filter(e=>"SWING_HIGH"===e.type).slice(-1)[0];return"LONG"===e.confluence.primaryBias&&i?{low:.999*i.price,high:1.001*i.price}:"SHORT"===e.confluence.primaryBias&&r?{low:.999*r.price,high:1.001*r.price}:"string"==typeof t?"Define stop below/above recent swing":t}(e,n),o=function(e,t){let i="LONG"===e.confluence.primaryBias?e.liquidityPools.find(e=>"BSL"===e.type):e.liquidityPools.find(e=>"SSL"===e.type);if(i)return{low:.999*i.price,high:1.001*i.price};let r=e.structureEvents.slice(-1)[0];return r?`Next swing at ${r.brokenLevel.toFixed(5)}`:t}(e,n),a=function(e,t,i){let r=i.session.killzone;return`${"NO_TRADE"===e?"No-trade":"LONG"===e?"Bullish":"Bearish"} setup with ${(100*t).toFixed(0)}% confidence during ${r}`}(i,r,e),l=function(e,t){let i=e.trend.direction,r=e.liquidityPools.some(e=>"BSL"===e.type)||e.liquidityPools.some(e=>"SSL"===e.type),n=e.fairValueGaps.length>0;return{what:`${i} market structure with recent ${r?"liquidity sweep":"swing break"} and ${n?"imbalance present":"balanced pricing"}.`,why:`Institutional flows favor ${"BULLISH"===i?"discount bids":"BEARISH"===i?"premium offers":"patience"} aligned with session ${e.session.killzone}.`,how:"NO_TRADE"===t?"Stand aside until HTF/LTF align; wait for fresh BOS/CHOCH and clean imbalance.":`Use the entry zone as a ${"LONG"===t?"discount":"premium"} area; invalidate if price closes beyond stop band.`}}(e,i);return{id:g(),symbol:t.symbol,timeframe:t.timeframe,direction:i,confidence:r,entryZone:n,stopZone:s,targetZone:o,killzone:e.session.killzone,rationaleShort:a,educationBlocks:l,generatedAt:new Date().toISOString()}}(c,{symbol:r,timeframe:n}),p={direction:u.direction},d={direction:"BULLISH"===c.trend.direction?"LONG":"BEARISH"===c.trend.direction?"SHORT":"RANGING"},h="NO_TRADE"===p.direction?{status:"SKIPPED",message:"No trade signal generated."}:"RANGING"===d.direction?{status:"SKIPPED",message:"Market is ranging. Waiting for clear trend."}:"LONG"===p.direction&&"LONG"===d.direction||"SHORT"===p.direction&&"SHORT"===d.direction?{status:"ALLOWED"}:{status:"BLOCKED",message:"Signal direction does not align with H4 trend."};if("SKIPPED"===h.status)return a.NextResponse.json({success:!0,data:null,message:h.message??A.d,meta:{discipline:"active"}},{status:200});if("BLOCKED"===h.status)return a.NextResponse.json({error:h.message??A.d},{status:422});return i&&await w(u),a.NextResponse.json({signal:u})}catch(t){let e=t instanceof Error?t.message:"Unknown error";return a.NextResponse.json({error:A.d,detail:e},{status:500})}}let E=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/aura-fx/signal/route",pathname:"/api/aura-fx/signal",filename:"route",bundlePath:"app/api/aura-fx/signal/route"},resolvedPagePath:"C:\\Projects\\Synqra\\apps\\synqra-mvp\\app\\api\\aura-fx\\signal\\route.ts",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:H,workUnitAsyncStorage:N,serverHooks:O}=E;function R(){return(0,o.patchFetch)({workAsyncStorage:H,workUnitAsyncStorage:N})}},7032:()=>{},408:()=>{},2780:(e,t,i)=>{"use strict";i.d(t,{F:()=>p});let r={lookback:50,minSwingSizePct:.05},n=e=>`${(100*e).toFixed(2)}%`,s=[{label:"LONDON_OPEN",start:"07:00",end:"10:00"},{label:"NY_OPEN",start:"12:30",end:"16:00"},{label:"ASIA_RANGE",start:"23:00",end:"02:00"}];function o(e,t){let i=new Date(e);return i.setUTCHours(Math.floor(t/60),t%60,0,0),i.toISOString()}let a={minImpulsePct:.0015},l={minSizePct:5e-4},c={alignment:.35,liquidity:.3,timeframe:.2,time:.15},u=e=>Math.min(1,Math.max(0,e));function p(e){let{candles:t,trendDirection:i,tzOffsetMinutes:p=0}=e,d=function(e,t=0){let i=function(e,t){if(e.length<3)return{direction:"RANGE",reason:"Insufficient candles"};let{lookback:i}={...r},s=e.slice(-i),o=s[0],a=(s[s.length-1].close-o.close)/o.close;return a>.015?{direction:"BULLISH",reason:`Price up ${n(a)} over lookback`}:a<-.015?{direction:"BEARISH",reason:`Price down ${n(a)} over lookback`}:{direction:"RANGE",reason:`Sideways ${n(a)} over lookback`}}(e),a=function(e,t=2){let i=[];for(let r=t;r<e.length-t;r++){let n=e.slice(r-t,r),s=e.slice(r+1,r+1+t),o=e[r],a=n.every(e=>e.high<o.high)&&s.every(e=>e.high<o.high),l=n.every(e=>e.low>o.low)&&s.every(e=>e.low>o.low);a&&i.push({type:"SWING_HIGH",index:r,price:o.high,time:o.time}),l&&i.push({type:"SWING_LOW",index:r,price:o.low,time:o.time})}return i}(e,2),l=function(e){let t=[];if(e.length<2)return t;for(let i=1;i<e.length;i++){let r=e[i-1],n=e[i],s="SWING_LOW"===r.type&&"SWING_HIGH"===n.type?n.price>r.price?"BULLISH":"RANGE":"SWING_HIGH"===r.type&&"SWING_LOW"===n.type?n.price<r.price?"BEARISH":"RANGE":null;if(!s)continue;let o="BULLISH"===s&&"SWING_HIGH"===n.type&&n.price>r.price||"BEARISH"===s&&"SWING_LOW"===n.type&&n.price<r.price?"BOS":"CHOCH";t.push({type:o,direction:s,brokenLevel:r.price,atIndex:n.index,time:n.time,fromSwing:r,toSwing:n})}return t}(a),c=function(e,t){let i=[];for(let e=0;e<t.length-1;e++){let r=t[e],n=t[e+1],s=Math.abs(5e-4*r.price);Math.abs(r.price-n.price)<=s&&("SWING_HIGH"===r.type&&"SWING_HIGH"===n.type&&i.push({type:"BSL",price:(r.price+n.price)/2,reason:"equal_highs",indices:[r.index,n.index]}),"SWING_LOW"===r.type&&"SWING_LOW"===n.type&&i.push({type:"SSL",price:(r.price+n.price)/2,reason:"equal_lows",indices:[r.index,n.index]}))}let r=[...t].reverse().find(e=>"SWING_HIGH"===e.type),n=[...t].reverse().find(e=>"SWING_LOW"===e.type);if(r){let e=8e-4*r.price,t=r.price+e;i.push({type:"BSL",price:t,reason:"stop_cluster_high",indices:[r.index]})}if(n){let e=8e-4*n.price,t=n.price-e;i.push({type:"SSL",price:t,reason:"stop_cluster_low",indices:[n.index]})}return function(e){let t=new Map;for(let i of e){let e=`${i.type}-${i.reason}-${i.price.toFixed(5)}`;t.has(e)||t.set(e,i)}return Array.from(t.values())}(i)}(0,a);return{trend:i,structurePoints:a,structureEvents:l,liquidityPools:c,session:function(e,t=0){let i=new Date(e+6e4*t),r=60*i.getUTCHours()+i.getUTCMinutes();for(let e of s){let[t,n]=e.start.split(":").map(Number),[s,a]=e.end.split(":").map(Number),l=60*t+n,c=60*s+a;if(l<=c?r>=l&&r<=c:r>=l||r<=c)return{killzone:e.label,isActive:!0,window:{start:o(i,l),end:o(i,c)}}}return{killzone:"NONE",isActive:!1,window:{start:o(new Date(e),0),end:o(new Date(e),0)}}}(e[e.length-1]?.time??Date.now(),t)}}(t,p),h=function(e,t,i){let{minImpulsePct:r}={...a},n=[];for(let i=1;i<e.length-2;i++){e[i-1];let s=e[i],o=e[i+1],a="BULLISH"===t&&s.close<s.open&&o.close>s.high,l="BEARISH"===t&&s.close>s.open&&o.close<s.low;(a||l)&&(("BULLISH"===t?(o.close-s.low)/s.low:(s.high-o.close)/s.high)<r||n.push({type:a?"DEMAND":"SUPPLY",originIndex:i,priceRange:{low:s.low,high:s.high},isMitigated:!1}))}return n}(t,i??d.trend.direction),f=function(e,t){let{minSizePct:i}={...l},r=[];for(let t=0;t<e.length-2;t++){let n=e[t],s=e[t+1],o=e[t+2],a=s.low>n.high&&o.low>n.high,l=s.high<n.low&&o.high<n.low;(a||l)&&((a?(s.low-n.high)/n.high:(n.low-s.high)/n.low)<i||r.push({direction:a?"BULLISH":"BEARISH",priceRange:a?{low:n.high,high:s.low}:{low:s.high,high:n.low},startIndex:t,endIndex:t+2,isFilled:!1}))}return r}(t),g=function(e){let t=[],i=function(e,t){let i=e.trendDirection,r=e.orderBlocks.some(e=>"DEMAND"===e.type),n=e.orderBlocks.some(e=>"SUPPLY"===e.type),s=e.fairValueGaps.some(e=>"BULLISH"===e.direction),o=e.fairValueGaps.some(e=>"BEARISH"===e.direction),a=.5;"BULLISH"===i&&r&&(a+=.2,t.push("Bullish HTF with demand OB")),"BEARISH"===i&&n&&(a+=.2,t.push("Bearish HTF with supply OB")),"BULLISH"===i&&s&&(a+=.1,t.push("Bullish FVG supports continuation")),"BEARISH"===i&&o&&(a+=.1,t.push("Bearish FVG supports continuation"));let l=e.structureEvents.some(e=>"BEARISH"===e.direction),c=e.structureEvents.some(e=>"BULLISH"===e.direction);return"BULLISH"===i&&l&&(a-=.2,t.push("MSS/BOS against bullish trend")),"BEARISH"===i&&c&&(a-=.2,t.push("MSS/BOS against bearish trend")),u(a)}(e,t),r=function(e,t){let i=e.liquidityPools.filter(e=>"BSL"===e.type),r=e.liquidityPools.filter(e=>"SSL"===e.type),n=.5;return"BULLISH"===e.trendDirection&&r.length&&(n+=.2,t.push("Liquidity resting below (SSL) for potential sweep")),"BEARISH"===e.trendDirection&&i.length&&(n+=.2,t.push("Liquidity resting above (BSL) for potential sweep")),i.length&&r.length&&(n-=.1,t.push("Both BSL/SSL present; liquidity balanced")),u(n)}(e,t),n=e.multiTimeframeBias?e.multiTimeframeBias===e.trendDirection?(t.push("Multi-timeframe agreement"),.8):(t.push("Timeframe conflict â€“ stand aside."),.2):.5,s=e.killzone.isActive?(t.push(`${e.killzone.killzone} active`),.8):.4,o=i*c.alignment+r*c.liquidity+n*c.timeframe+s*c.time,a=function(e,t,i,r){if(e.multiTimeframeBias&&e.multiTimeframeBias!==e.trendDirection&&r<.3)return"NO_TRADE";let n=.5*t+.3*i+.2*r;return n>=.65?"BULLISH"===e.trendDirection?"LONG":"SHORT":n<=.4?"NO_TRADE":"BULLISH"===e.trendDirection?"LONG":"SHORT"}(e,i,r,n);return{trendScore:i,liquidityScore:r,structureScore:i,timeScore:s,overallScore:u(o),primaryBias:a,notes:t}}({trendDirection:i??d.trend.direction,structureEvents:d.structureEvents,liquidityPools:d.liquidityPools,orderBlocks:h,fairValueGaps:f,killzone:d.session});return{...d,orderBlocks:h,fairValueGaps:f,confluence:g}}},6357:(e,t,i)=>{"use strict";i.d(t,{d:()=>r});let r="An unexpected error occurred. Please try again."}};var t=require("../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),r=t.X(0,[6207,8048],()=>i(1990));module.exports=r})();