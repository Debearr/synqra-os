(()=>{var e={};e.id=3079,e.ids=[3079],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},6631:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>f,serverHooks:()=>y,workAsyncStorage:()=>b,workUnitAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{DELETE:()=>h,GET:()=>c,PATCH:()=>x,POST:()=>d,PUT:()=>g});var n=r(1271),o=r(1232),a=r(8079),i=r(1238);let u=[{model:"anthropic/claude-3-5-sonnet-20241022",name:"Claude",role:"Strategic Advisor"},{model:"openai/gpt-4-turbo",name:"GPT-4",role:"Technical Expert"}];async function m(e){return{consensus:"Council consultation pending implementation.",responses:(e.members||u).map(e=>({member:e,response:"Response pending implementation.",tokens:{total:0,prompt:0,completion:0}})),timestamp:new Date().toISOString()}}var p=r(7759);async function l(e){console.log("Council usage logging pending implementation:",e.requestId)}async function d(e){let t;let s=Date.now();try{let n=await e.json();if(!n.prompt||"string"!=typeof n.prompt)return i.NextResponse.json({error:"Invalid request",message:"The 'prompt' field is required and must be a string"},{status:400});let o=n.prompt.trim().length;if(0===o)return i.NextResponse.json({error:"Invalid request",message:"Prompt cannot be empty"},{status:400});if(o>1e4)return i.NextResponse.json({error:"Invalid request",message:"Prompt exceeds maximum length of 10,000 characters"},{status:400});if(n.members){if(!Array.isArray(n.members)||0===n.members.length)return i.NextResponse.json({error:"Invalid request",message:"Members must be a non-empty array"},{status:400});if(n.members.length>10)return i.NextResponse.json({error:"Invalid request",message:"Maximum 10 council members allowed"},{status:400});for(let e of n.members)if(!e.model||!e.name||!e.role)return i.NextResponse.json({error:"Invalid request",message:"Each member must have 'model', 'name', and 'role' fields"},{status:400})}if(void 0!==n.temperature&&("number"!=typeof n.temperature||n.temperature<0||n.temperature>2))return i.NextResponse.json({error:"Invalid request",message:"Temperature must be a number between 0 and 2"},{status:400});if(void 0!==n.maxTokens&&("number"!=typeof n.maxTokens||n.maxTokens<1||n.maxTokens>8e3))return i.NextResponse.json({error:"Invalid request",message:"maxTokens must be a number between 1 and 8000"},{status:400});let a=(e.headers.get("x-synqra-tier")||"").toLowerCase(),u=e.headers.get("x-synqra-fp"),d=e.headers.get("x-forwarded-for")?.split(",")[0]?.trim()||e.headers.get("x-real-ip")||null,c=e.headers.get("user-agent"),g=e.headers.get("authorization"),h=g?"premium":"premium"===a||"enterprise"===a?a:"free";if("free"===h)try{(0,p.u)({tier:h,fingerprint:u||null,email:e.headers.get("x-synqra-email")||null,ip:d,userAgent:c})}catch(e){if(e instanceof p.J)return i.NextResponse.json({error:"Rate limit exceeded",message:e.message},{status:e.status});throw e}t=`council_${Date.now()}_${Math.random().toString(36).substring(7)}`;let x=n.systemPrompt;if(g)try{let{createClient:e}=await r.e(1525).then(r.bind(r,1525)),{getSupabaseUrl:t,getSupabaseAnonKey:s}=await r.e(4291).then(r.bind(r,4291)),n=e(t(),s(),{global:{headers:{Authorization:g}}}),{data:{user:o}}=await n.auth.getUser();if(o?.user_metadata){let{industry:e,role:t,goal:r}=o.user_metadata;if(e||t||r){let s=`You are advising a ${t||"professional"} in the ${e||"business"} sector. Prioritize guidance aligned with ${r||"their objectives"}.`;x=x?`${x}

${s}`:s}}}catch(e){console.warn("Failed to inject user metadata:",e)}let f=await m({prompt:n.prompt.trim(),systemPrompt:x,members:n.members,temperature:n.temperature,maxTokens:n.maxTokens}),b=f.responses.reduce((e,t)=>e+(t.tokens?.total||0),0),w=f.responses.reduce((e,t)=>e+(t.tokens?.prompt||0),0),y=f.responses.reduce((e,t)=>e+(t.tokens?.completion||0),0),v=Date.now()-s;return await l({requestId:t,prompt:n.prompt.trim(),responses:f.responses,totalTokens:b,totalPromptTokens:w,totalCompletionTokens:y,duration:v,tier:h}),i.NextResponse.json({...f,metadata:{requestId:t,totalTokens:b,totalPromptTokens:w,totalCompletionTokens:y,duration:v,tier:h}},{status:200})}catch(e){return console.error("AI Council API error:",e),t&&await l({requestId:t,prompt:"",responses:[],totalTokens:0,totalPromptTokens:0,totalCompletionTokens:0,duration:Date.now()-s,error:e instanceof Error?e.message:"Unknown error"}).catch(()=>{}),i.NextResponse.json({error:"Council query failed",message:e instanceof Error?e.message:"Unknown error",requestId:t},{status:500})}}async function c(){return i.NextResponse.json({endpoint:"/api/council",method:"POST",description:"Query multiple AI models for diverse perspectives",defaultMembers:u.map(e=>({name:e.name,role:e.role,model:e.model})),requestSchema:{prompt:"string (required) - The question or prompt for the council",systemPrompt:"string (optional) - Custom system prompt",members:"array (optional) - Custom council members",temperature:"number (optional) - Temperature for responses (0-1)",maxTokens:"number (optional) - Maximum tokens per response"},example:{prompt:"What are the key considerations for building a scalable SaaS product?",temperature:.7}})}async function g(){return new i.NextResponse("Method Not Allowed",{status:405,headers:{Allow:"GET, POST"}})}async function h(){return new i.NextResponse("Method Not Allowed",{status:405,headers:{Allow:"GET, POST"}})}async function x(){return new i.NextResponse("Method Not Allowed",{status:405,headers:{Allow:"GET, POST"}})}let f=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/council/route",pathname:"/api/council",filename:"route",bundlePath:"app/api/council/route"},resolvedPagePath:"C:\\Projects\\Synqra\\apps\\synqra-mvp\\app\\api\\council\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:b,workUnitAsyncStorage:w,serverHooks:y}=f;function v(){return(0,a.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:w})}},7032:()=>{},408:()=>{},7759:(e,t,r)=>{"use strict";r.d(t,{J:()=>s,u:()=>n});class s extends Error{constructor(e,t=429){super(e),this.status=t,this.name="PublicGatekeeperError"}}function n(e){e.tier}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[6207,8048],()=>r(6631));module.exports=s})();