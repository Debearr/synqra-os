(()=>{var e={};e.id=1151,e.ids=[1151],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3125:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>c,serverHooks:()=>f,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>m});var o={};r.r(o),r.d(o,{POST:()=>p});var n=r(1271),s=r(1232),i=r(8079),a=r(1238),u=r(1062),l=r(1540);async function p(e){try{let{jobId:t,platforms:r,payloads:o}=await e.json();if(!t||!r||!Array.isArray(r))return a.NextResponse.json({ok:!1,error:"Missing jobId or platforms"},{status:400});if(!l.$.postingEnabled&&!l.$.dryRun)return a.NextResponse.json({ok:!1,error:"Posting disabled"},{status:403});let n=[];for(let e of r){let r=o?.[e];if(!r){console.warn(`‚ö†Ô∏è  No payload for ${e}`);continue}(0,u.Z)({platform:e,payload:r,jobId:t}),n.push(e)}return a.NextResponse.json({ok:!0,jobId:t,enqueued:n,dryRun:l.$.dryRun,message:l.$.dryRun?"Jobs enqueued in DRY_RUN mode - no actual posts will be made":`${n.length} jobs enqueued for posting`})}catch(e){return console.error("Publish error:",e),a.NextResponse.json({ok:!1,error:e.message},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/publish/route",pathname:"/api/publish",filename:"route",bundlePath:"app/api/publish/route"},resolvedPagePath:"C:\\Projects\\Synqra\\apps\\synqra-mvp\\app\\api\\publish\\route.ts",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:d,workUnitAsyncStorage:m,serverHooks:f}=c;function g(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:m})}},7032:()=>{},408:()=>{},1540:(e,t,r)=>{"use strict";r.d(t,{$:()=>o,_:()=>n});let o={dryRun:"false"!==process.env.DRY_RUN,postingEnabled:"true"===process.env.POSTING_ENABLED,approvalRequired:"false"!==process.env.APPROVAL_REQUIRED,timezone:process.env.DEFAULT_TIMEZONE||"America/Toronto",retryAttempts:3,retryDelays:[1e4,3e4,6e4]};function n(){return o.dryRun?(console.log("\uD83E\uDDEA DRY_RUN mode - no actual posting"),!1):!!o.postingEnabled||(console.log("\uD83D\uDEAB Posting disabled"),!1)}},1062:(e,t,r)=>{"use strict";r.d(t,{Z:()=>m,F:()=>g});var o=r(1540),n=r(1525);async function s(e,t){let r=function(){let e=process.env.SUPABASE_URL,t=process.env.SUPABASE_SERVICE_KEY||process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Missing Supabase configuration");return(0,n.createClient)(e,t)}(),{data:o,error:s}=await r.from("social_tokens").select("access_token, account_id").eq("platform","LinkedIn").order("created_at",{ascending:!1}).limit(1).single();if(s||!o)throw Error("LinkedIn token not found - run OAuth flow first");let{access_token:i}=o,a=t||o.account_id;if(!a)throw Error("LinkedIn account ID not configured");let u={author:a,lifecycleState:"PUBLISHED",specificContent:{"com.linkedin.ugc.ShareContent":{shareCommentary:{text:e.text},shareMediaCategory:e.media?"IMAGE":"NONE",...e.media&&{media:e.media.map(e=>({status:"READY",originalUrl:e.url,title:{text:e.title||""}}))}}},visibility:{"com.linkedin.ugc.MemberNetworkVisibility":"PUBLIC"}},l=await fetch("https://api.linkedin.com/v2/ugcPosts",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json","X-Restli-Protocol-Version":"2.0.0"},body:JSON.stringify(u)});if(!l.ok){let e=await l.text();throw Error(`LinkedIn API error: ${l.status} - ${e}`)}let p=await l.json();return await r.from("posting_logs").insert({platform:"LinkedIn",status:"success",response:p,external_id:p.id}),p}async function i(e){throw console.log("\uD83D\uDCF1 TikTok posting stub - implement OAuth flow"),Error("TikTok integration pending - requires OAuth setup")}async function a(e){throw console.log("\uD83D\uDCFA YouTube posting stub - implement OAuth flow"),Error("YouTube integration pending - requires OAuth setup")}async function u(e){throw console.log("\uD83D\uDC26 X posting stub - implement OAuth flow"),Error("X integration pending - requires OAuth setup")}async function l(e){throw console.log("\uD83D\uDCF8 Instagram posting stub - implement OAuth flow"),Error("Instagram integration pending - requires OAuth setup")}async function p(e,t){if(!(0,o._)())return{ok:!0,action:"dry-run",platform:e,payload:t,message:"DRY_RUN mode - no actual post made"};let r={LinkedIn:s,TikTok:i,YouTube:a,X:u,Instagram:l}[e];if(!r)throw Error(`Unsupported platform: ${e}`);try{let o=await r(t);return console.log(`‚úÖ Posted to ${e}`,o),{ok:!0,platform:e,result:o}}catch(t){throw console.error(`‚ùå Failed to post to ${e}:`,t.message),t}}let c=[],d=!1;function m(e){let t={...e,id:crypto.randomUUID(),attempts:0};c.push(t),console.log(`üì• Enqueued: ${e.platform} for job ${e.jobId}`),f()}async function f(){if(!d&&0!==c.length){d=!0;try{let e=c.shift();if(!e)return;try{await p(e.platform,e.payload),console.log(`‚úÖ Processed: ${e.platform} for job ${e.jobId}`)}catch(t){if(e.attempts++,e.attempts<o.$.retryAttempts){let t=o.$.retryDelays[e.attempts-1]||6e4;console.log(`‚è∞ Retry ${e.attempts}/${o.$.retryAttempts} for ${e.platform} in ${t}ms`),setTimeout(()=>{c.unshift(e),f()},t)}else console.error(`‚ùå Failed permanently: ${e.platform} for job ${e.jobId}`,t.message)}}finally{d=!1,c.length>0&&setTimeout(f,1e3)}}}function g(){return c.length}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[6207,8048,1525],()=>r(3125));module.exports=o})();