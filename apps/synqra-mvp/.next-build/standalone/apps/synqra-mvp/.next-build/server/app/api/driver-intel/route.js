(()=>{var e={};e.id=5743,e.ids=[5743],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},4614:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>O,routeModule:()=>E,serverHooks:()=>H,workAsyncStorage:()=>Y,workUnitAsyncStorage:()=>T});var a={};r.r(a),r.d(a,{GET:()=>R,POST:()=>$});var i=r(1271),n=r(1232),o=r(8079),s=r(1238);let u=e=>Math.round(100*e)/100,l=e=>{let{base:t,bonus:r,tips:a,reimbursements:i,adjustments:n=0}=e.payout;return t+r+a+i+n},p=(e=[])=>e.reduce((e,t)=>e+t.amount,0);function c(e,t,r){let a=e.map(e=>(function(e,t){let r=l(e),a=(t?.vehicleCostPerMile??0)*e.distanceMiles,i=a+p(t?.extraExpenses);return{offerId:e.id,gross:u(r),net:u(r-i),mileage:e.distanceMiles,durationMinutes:e.durationMinutes,payoutBreakdown:e.payout,expenseImpact:[...a?[{expense:{category:"maintenance",amount:u(a),label:"per-mile vehicle cost"},appliedTo:e.id}]:[],...t?.extraExpenses?.map(t=>({expense:t,appliedTo:e.id}))??[]],serviceType:e.serviceType}})(e,{vehicleCostPerMile:r?.vehicleCostPerMile})),i=a.reduce((e,t)=>e+t.gross,0),n=p(r?.extraExpenses)+(r?.vehicleCostPerMile??0)*e.reduce((e,t)=>e+t.distanceMiles,0),o=i-n,s=e.reduce((e,t)=>e+t.distanceMiles,0),c=e.reduce((e,t)=>e+t.durationMinutes,0),d=c>0?o/(c/60):o,m=s>0?o/s:o,h=a.reduce((e,t)=>{let r=t.serviceType??"unspecified";return e[r]=(e[r]??0)+t.net,e},{}),g=r?.targetEarningsPerHour!==void 0?u(d-r.targetEarningsPerHour):void 0;return{date:t,grossTotal:u(i),netTotal:u(o),expensesTotal:u(n),totalAdjustments:u(e.reduce((e,t)=>e+(t.payout.adjustments??0),0)),totalMiles:s,activeMinutes:c,earningsPerHour:u(d),earningsPerMile:u(m),varianceFromTargetPerHour:g,byServiceType:h,offers:a}}let d=e=>Math.round(100*e)/100,m=e=>e.payout.base+e.payout.bonus+e.payout.tips+e.payout.reimbursements+(e.payout.adjustments??0),h=(e,t,r)=>Math.min(r,Math.max(t,e)),g=e=>Math.round(10*e)/10,M={distance:.25,payout:.35,duration:.1,multiStop:.1,weight:.05,rating:.1};var f=r(4493);let x=f.Ik({base:f.ai().nonnegative().default(0),bonus:f.ai().nonnegative().default(0),tips:f.ai().nonnegative().default(0),reimbursements:f.ai().nonnegative().default(0),adjustments:f.ai().default(0)}),y=f.Ik({id:f.Yj(),serviceType:f.k5(["delivery","rideshare","freight","other"]).optional(),payout:x,distanceMiles:f.ai().nonnegative(),durationMinutes:f.ai().nonnegative(),weightLbs:f.ai().nonnegative().optional(),multiStop:f.zM().optional(),stops:f.YO(f.Ik({id:f.Yj(),sequence:f.ai(),distanceFromPrevMiles:f.ai().optional(),eta:f.Yj().datetime().optional(),weightLbs:f.ai().optional(),notes:f.Yj().optional()})).optional(),acceptedAt:f.Yj().datetime(),completedAt:f.Yj().datetime(),rating:f.ai().min(0).max(5).optional(),metadata:f.g1(f.Yj(),f.bz()).optional()}),v=f.Ik({category:f.k5(["fuel","maintenance","parking","tolls","rentals","insurance","other"]).default("other"),amount:f.ai().nonnegative(),label:f.Yj().optional(),timestamp:f.Yj().datetime().optional()}),k=f.Ik({start:f.Yj().datetime(),end:f.Yj().datetime().optional(),type:f.k5(["meal","rest","refuel","personal"]).optional(),flaggedBySystem:f.zM().optional()}),b=f.Ik({id:f.Yj(),date:f.Yj(),window:f.Ik({start:f.Yj().datetime(),end:f.Yj().datetime(),timezone:f.Yj().optional()}),offers:f.YO(y),breaks:f.YO(k).optional(),expenses:f.YO(v).optional(),vehicle:f.Ik({id:f.Yj(),type:f.k5(["car","van","bike","scooter","cargo"]),mpg:f.ai().optional(),costPerMile:f.ai().optional(),electric:f.zM().optional()}).optional(),metadata:f.g1(f.Yj(),f.bz()).optional()}),P=f.Ik({hrBpm:f.ai().optional(),hydrationOz:f.ai().optional(),steps:f.ai().optional(),sleepHours:f.ai().optional(),stressLevel:f.ai().min(0).max(10).optional(),fatigueLevel:f.ai().min(0).max(10).optional(),mood:f.k5(["great","ok","tired","burned-out"]).optional(),timestamp:f.Yj().datetime().optional()}),S={type:"object",properties:{total:{type:"number"},normalized:{type:"number"},breakdown:{type:"object",properties:{distance:{type:"number"},payout:{type:"number"},duration:{type:"number"},multiStop:{type:"number"},weight:{type:"number"},rating:{type:"number"},custom:{type:"object",additionalProperties:{type:"number"}}},required:["distance","payout","duration","multiStop","weight","rating"]},reasons:{type:"array",items:{type:"string"}}},required:["total","normalized","breakdown","reasons"]},j={type:"object",properties:{score:{type:"number"},fatigueRisk:{type:"string",enum:["low","moderate","high"]},hydrationStatus:{type:"string",enum:["ok","low","unknown"]},sleepDebtHours:{type:"number"},cooldownMinutes:{type:"number"},recommendations:{type:"array",items:{type:"string"}},factors:{type:"object",additionalProperties:{type:"number"}}},required:["score","fatigueRisk","hydrationStatus","cooldownMinutes","recommendations","factors"]},w=`
You are the N\xd8ID Driver Intelligence orchestrator.
- Maintain factual calculations for payouts, filters, and health scores.
- Respond ONLY with JSON that matches the provided JSON schema.
- Keep reasoning concise and machine-readable.
`.trim();async function R(){return s.NextResponse.json({ok:!0,message:"Driver Intelligence mock endpoints ready",schemas:{offerScoreJsonSchema:S,driverHealthJsonSchema:j},prompt:w})}async function $(e){try{let a=await e.json(),i=a.action??"scoreOffer";switch(i){case"scoreOffer":{let e=y.parse(a.offer),t=function(e,t){let r=e.distanceMiles,a=t.preferredRangeMiles??[0,t.maxDistanceMiles],i=r<=t.maxDistanceMiles,n=r>=a[0]&&r<=a[1];return{score:Math.min(100,(i?70:0)+(n?30:r<a[0]?15:0)),passes:i,rationale:i?`Distance ${r}mi within max ${t.maxDistanceMiles}mi${n?" and in preferred range":""}`:`Distance ${r}mi exceeds max ${t.maxDistanceMiles}mi`}}(e,{maxDistanceMiles:a.maxDistanceMiles??25,preferredRangeMiles:a.preferredRangeMiles}),r=function(e,t){let r=m(e),a=e.distanceMiles>0?r/e.distanceMiles:r,i=e.durationMinutes>0?r/e.durationMinutes:r,n=a>=t.minRatePerMile,o=void 0===t.minRatePerMinute||i>=t.minRatePerMinute,s=n&&o;return{score:Math.min(100,(n?60:20)+(o?40:t.minRatePerMinute?0:20)+Math.max(0,Math.min(20,(a-t.minRatePerMile)*10))),passes:s,ratePerMile:d(a),ratePerMinute:d(i),rationale:s?`Rates meet thresholds (${d(a)} $/mi, ${d(i)} $/min)`:`Rates below thresholds (${d(a)} $/mi vs ${t.minRatePerMile} $/mi min${t.minRatePerMinute?`, ${d(i)} $/min vs ${t.minRatePerMinute} $/min min`:""})`}}(e,{minRatePerMile:a.minRatePerMile??1.2,minRatePerMinute:a.minRatePerMinute??.25}),i=function(e,t){let r=e.weightLbs;if(void 0===r)return{score:60,passes:!0,rationale:"Weight not provided; default pass with neutral score"};let a=r<=t.maxWeightLbs;return{score:Math.max(0,100-r/t.maxWeightLbs*40),passes:a,rationale:a?`Weight ${r}lbs within max ${t.maxWeightLbs}lbs`:`Weight ${r}lbs exceeds max ${t.maxWeightLbs}lbs`}}(e,{maxWeightLbs:a.maxWeightLbs??50}),n=function(e,t){let r=e.stops??[],a=r.length,i=t.maxStops??5,n=a>1&&e.distanceMiles>0?(e.distanceMiles-(r[0]?.distanceFromPrevMiles??0))/a:0,o=a<=i,s=void 0===t.maxExtraMilesPerStop||n<=t.maxExtraMilesPerStop,u=o&&s;return{score:Math.min(100,(o?60:20)+(s?30:10)+(a>1?10:0)),passes:u,rationale:u?`Multi-stop efficiency acceptable (${a} stops, ~${d(n)} extra mi/stop)`:`Multi-stop inefficiency (${a} stops, ~${d(n)} extra mi/stop)`}}(e,{maxStops:a.maxStops??5,maxExtraMilesPerStop:a.maxExtraMilesPerStop??6}),o=Math.max(20,100-Math.min(e.durationMinutes,90)),u=function(e,t){let r=function(e,t=M){let r=(e.distanceScore??0)*(t.distance??0),a=(e.payoutScore??0)*(t.payout??0),i=(e.durationScore??0)*(t.duration??0),n=(e.multiStopScore??0)*(t.multiStop??0),o=(e.weightScore??0)*(t.weight??0),s=(e.driverRatingScore??80)*(t.rating??0),u=Object.entries(e.customScores??{}).reduce((e,[r,a])=>{let i=t.custom?.[r]??0;return e[r]=(a??0)*i,e},{}),l=Object.values(u).reduce((e,t)=>e+(t??0),0),p=[];return(e.payoutScore??0)>=80&&p.push("Strong payout"),(e.distanceScore??0)>=70&&p.push("Route within preferred range"),(e.multiStopScore??0)<40&&p.push("Multi-stop efficiency risk"),(e.weightScore??0)<50&&p.push("Heavy load consideration"),{total:r+a+i+n+o+s+l,components:{distance:r,payout:a,duration:i,multiStop:n,weight:o,rating:s,custom:u},reasons:p}}(e,void 0),a=Math.max(0,Math.min(100,r.total));return{total:r.total,normalized:a,breakdown:r,metadata:{weightPreset:"default"}}}({distanceScore:t.score,payoutScore:r.score,durationScore:o,weightScore:i.score,multiStopScore:n.score,driverRatingScore:e.rating?e.rating/5*100:void 0});return s.NextResponse.json({ok:!0,data:{filters:{distance:t,payout:r,weight:i,multiStop:n},score:u},meta:{model:function(e){let t=e.priority??"speed",r=e.payloadTokens??512;return"quality"===t?{model:"gpt-4o-mini",tier:"accurate",reason:"Quality-first route for driver intelligence reasoning",temperature:.2,maxTokens:Math.min(4096,2*r)}:"cost"===t?{model:"gpt-3.5-mini",tier:"fast",reason:"Cost-sensitive route for filter evaluation",temperature:0,maxTokens:Math.min(2048,2*r)}:{model:"gpt-4o-mini",tier:"balanced",reason:"Default balanced route",temperature:"health"===e.task?.1:.25,maxTokens:Math.min(3072,2*r)}}({task:"scoring",priority:a.priority,payloadTokens:512}),schema:S}})}case"dailyEarnings":{var t,r;let e=(t=b.parse(a.day),r={vehicleCostPerMile:a.vehicleCostPerMile,targetEarningsPerHour:a.targetEarningsPerHour,extraExpenses:a.extraExpenses},c(t.offers,t.date,{vehicleCostPerMile:t.vehicle?.costPerMile??r?.vehicleCostPerMile,targetEarningsPerHour:r?.targetEarningsPerHour,extraExpenses:t.expenses??r?.extraExpenses}));return s.NextResponse.json({ok:!0,data:e})}case"projectShift":{let e=y.array().parse(a.completedOffers),t=function(e){let{shiftWindowMinutes:t,elapsedMinutes:r,completedOffers:a,options:i}=e,n=c(a,new Date().toISOString().slice(0,10),i),o=r>0?n.netTotal/(r/60):0,s=Math.max(t-r,0),u=n.netTotal+s/60*o;return{projectedGross:Math.round(100*(n.grossTotal+n.grossTotal/Math.max(r,1)*(s/60)*60))/100,projectedNet:Math.round(100*u)/100,projectedEarningsPerHour:Math.round(100*o)/100,remainingMinutes:s,recommendedPacePerHour:i?.targetEarningsPerHour}}({shiftWindowMinutes:a.shiftWindowMinutes??480,elapsedMinutes:a.elapsedMinutes??0,completedOffers:e,options:{vehicleCostPerMile:a.vehicleCostPerMile,targetEarningsPerHour:a.targetEarningsPerHour}});return s.NextResponse.json({ok:!0,data:t})}case"health":{let e=P.parse(a.snapshot),t=function(e,t){let r=e.hydrationOz??0,a=e.sleepHours??0,i=e.steps??0,n=h(r/80*100,0,100),o=h(a/8*100,0,100),s=h(i/8e3*100,0,100),u=function(e,t){let r=e.stressLevel??5,a=e.fatigueLevel??5,i=t?.hoursDriven??0,n=t?.lastBreakMinutesAgo??120,o=(r+a)*5;return o+=Math.max(0,(i-6)*5),h(o+=Math.max(0,(n-90)*.5),0,100)}(e,t),l=.25*n+.35*o+.1*s+(100-u)*.3,p=Math.max(0,8-a),c=u>70?"high":u>40?"moderate":"low",d=n<50?"low":"ok",m=Math.max(u>70?30:u>40?15:5,Math.round((t?.lastBreakMinutesAgo??120)/60*10));return{score:Math.round(l),fatigueRisk:c,hydrationStatus:d,sleepDebtHours:g(p),cooldownMinutes:m,recommendations:function(e){let t=[];return e.hydrationScore<60&&t.push("Hydrate: target +12-16 oz water."),e.sleepScore<60&&t.push("Schedule rest: aim for 7-8 hours tonight."),e.activityScore<40&&t.push("Light stretch: 3-5 minutes to reduce stiffness."),e.fatigue>70?t.push("Take a 20-30 minute break; avoid accepting long trips."):e.fatigue>40&&t.push("Short cooldown: 10-15 minutes before next batch."),(e.lastBreakMinutesAgo??0)>120&&t.push("Log a break: >2 hours since last rest."),t}({fatigue:u,hydrationScore:n,sleepScore:o,activityScore:s,lastBreakMinutesAgo:t?.lastBreakMinutesAgo}),factors:{hydrationScore:g(n),sleepScore:g(o),activityScore:g(s),fatigueScore:g(u)}}}(e,{hoursDriven:a.hoursDriven,lastBreakMinutesAgo:a.lastBreakMinutesAgo});return s.NextResponse.json({ok:!0,data:t,schema:j})}default:return s.NextResponse.json({ok:!1,error:`Unknown action: ${i}`},{status:400})}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return s.NextResponse.json({ok:!1,error:e},{status:400})}}let E=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/driver-intel/route",pathname:"/api/driver-intel",filename:"route",bundlePath:"app/api/driver-intel/route"},resolvedPagePath:"C:\\Projects\\Synqra\\apps\\synqra-mvp\\app\\api\\driver-intel\\route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:Y,workUnitAsyncStorage:T,serverHooks:H}=E;function O(){return(0,o.patchFetch)({workAsyncStorage:Y,workUnitAsyncStorage:T})}},7032:()=>{},408:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[6207,8048,4493],()=>r(4614));module.exports=a})();